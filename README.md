# 🍇 멀티스레드 티켓팅 시뮬레이터 (Multi-threaded Ticketing Simulator)

이 프로젝트는 아이돌 콘서트 예매와 같은 **고동시성(High-concurrency)** 환경을 자바 멀티스레딩 기술로 구현한 시뮬레이션입니다.

**경쟁 상태(Race Condition)** 해결, **스레드 동기화**, 그리고 `wait/notify` 메커니즘을 이용한 **스레드 간 통신**을 실습하기 위해 설계되었습니다.

## 🚀 주요 기능

* **Thread-Safe 예약 시스템**: `synchronized` 블록을 사용하여 여러 사용자가 동시에 같은 좌석을 예약하려 할 때 데이터가 꼬이지 않도록 보장합니다.
* **제한 시간 대기 및 재시도 (Timed-Wait & Retry)**: 사용자는 자리가 없다고 바로 포기하지 않습니다. 특정 좌석을 최대 **10초 동안** 기다리며, 시간이 초과되면 지능적으로 다른 "포도알(빈 좌석)"을 찾아 이동합니다.
* **역동적인 취소 시나리오**: 예약에 성공한 사용자가 일정 확률로 예약을 취소합니다. 이때 `notifyAll()` 신호가 발생하여 대기 중이던 스레드들이 즉시 다시 경쟁을 시작합니다.
* **실시간 콘솔 시각화**: ANSI 색상 코드를 활용하여 좌석 현황을 실시간으로 출력합니다.
* 🍇 `[●]` : 예매 가능한 **포도알** (보라색)
* ❌ `[X]` : 이미 선택된 좌석 (회색)
* ⚠️ `[대기/취소]` : 노란색과 빨간색 로그로 실시간 상황 강조



---

## 🏗 프로젝트 아키텍처

관심사 분리(SoC)를 위해 다음과 같은 구조로 설계되었습니다:

* **`model.Seat`**: 공유 자원인 좌석 객체.
* **`manager.TicketingManager`**: **임계 영역(Critical Section)** 관리자. 예약(`reserveWithTimeout`) 및 취소(`cancelReservation`) 로직의 동기화를 제어합니다.
* **`thread.UserAction`**: `Runnable` 구현체. 사용자의 무작위 좌석 선택, 대기, 취소 행동을 정의합니다.
* **`common.ThreadUtil`**: `Thread.sleep()` 시 발생하는 예외 처리를 간소화하고 인터럽트 상태를 관리합니다.

---

## 🛠 기술 스택

* **Language**: Java 17
* **Build Tool**: Maven

---

## 📊 시뮬레이션 흐름

1. **초기화**: 메모리 내에 5~10개의 좌석을 생성합니다.
2. **경쟁 발생**: 30명의 사용자(Thread)가 동시에 접속하여 좌석 선점을 시도합니다.
3. **대기 및 신호**:
* 좌석이 없으면 사용자는 `WAITING` 상태로 대기합니다.
* 예약자가 취소하면 `notifyAll()` 사이렌이 울립니다.
* 잠들어 있던 스레드들이 깨어나 빈 좌석을 향해 다시 레이스를 펼칩니다.


4. **최종 리포트**: 모든 활동이 종료되면 좌석별 최종 소유주와 예약 통계를 출력합니다.

---

## 📝 학습 포인트

* 고동시성 환경에서 **Race Condition**을 방지하는 동기화 기법 습득.
* **Thread States** (TIMED_WAITING, WAITING, RUNNABLE) 간의 전환 이해.
* 사용자 정의 예외(`AlreadyReservedException`)를 통한 비즈니스 로직 처리.
* `wait(timeout)`을 활용한 효율적인 자원 관리 및 교착 상태(Deadlock) 방지.

---

### 💡 팁

콘솔에서 보라색 포도알이 사라졌다가 취소표 발생 시 다시 생겨나는 역동적인 과정을 관찰해 보세요! 
`Main.java`에서 `userCount`를 늘리면 시스템에 더 높은 부하를 주어 동기화 성능을 테스트할 수 있습니다. 🍇
